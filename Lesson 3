<!DOCTYPE html>
<html>
  <head>
    <title> . </title>
  </head>

  <body>


    <div class="js-container"></div>
        
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
   
   
   //Creating ChatInput component
    function ChatInput({ chatMessages, setChatMessages }){
    
      const [inputText, setInputText] = React.useState('');    
      //save user input in setInputText
      function saveInputText(event){
      setInputText(event.target.value);                        
      }

      //saving user and robot input & add to the array:
      function sendMessage(){
        //save user input & add
        const newChatMessages = [             
          ...chatMessages,         
          {
            message: inputText,
            sender: 'user',
            id: crypto.randomUUID()
          }
        ];
        setChatMessages(newChatMessages);
        
        // save robot reply & add
       const response = Chatbot.getResponse(inputText);  
       setChatMessages([             
          ...newChatMessages,         
          {
            message: response,
            sender: 'robot',
            id: crypto.randomUUID()
          }
        ]);
        //clear the input
        setInputText('')
      }

      return (
        <>
          <input
              placeholder="Send a message to Chatbot"
              size="20"
              onChange={saveInputText}
              value={inputText}
            />
          <button 
            onClick={sendMessage}
          >Send</button>
        </>
      );

    }



    // Display text & show image based on sender
    function ChatMessage({message, sender}){
   
      return(
        <div>
          {sender ==='robot' && <img src="images/robot.png" width="50"/>}
          {message}
          {sender === 'user' && <img src="images/user.png" width="50"/>}

        </div>
      );
      
    }

    //Take the array, loop, & display each message
    function ChatMessages({ chatMessages }){ 
      return(
          <>
            {chatMessages.map((chatMessage) => {
              return(
                <ChatMessage 
                  message = {chatMessage.message}
                  sender = {chatMessage.sender}
                  key = {chatMessage.id}
                />
              );

            })}
        </>
      )

    }
   
    //Keep chat history
    function App(){
      const [chatMessages, setChatMessages] = React.useState([{
          message: 'hello chatbot',
          sender: 'user',
          id: 'id1'
        }, {
          message: 'Hello! How can I help you?',
          sender: 'robot',
          id: 'id2'
        }, {
          message: 'What is todays date?',
          sender: 'user',
          id: 'id3'
        }, {
          message: 'Todays date is December 31',
          sender: 'robot',
          id: 'id4'
        }]
      );
     
      return (
        <>
          <ChatInput 
            chatMessages={chatMessages}
            setChatMessages={setChatMessages}
          />
          <ChatMessages 
            chatMessages={chatMessages}
          />
        </>
      );

    }

    // Render
      const container = document.querySelector('.js-container'); 
      ReactDOM.createRoot(container).render(<App />);

    </script>

  </body>
</html>
